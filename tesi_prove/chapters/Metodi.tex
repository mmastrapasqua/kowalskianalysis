Quando bisogna recarsi presso una via mai sentita prima, solitamente ci si affida a servizi di navigazione per ottenere informazioni sul percorso più veloce da intraprendere.
Il mezzo di trasporto invece, nella maggior parte dei casi, viene scelto a priori dall'utente per diversi motivi come abitudine, differenza di prezzo o mancanza di interesse per le alternative, nonostante esistano servizi come Google che di default offrono soluzioni per ogni mezzo possibile.

Lo stato attuale della tecnologia permette ai provider di questi servizi di avere una stima del tempo di percorrenza molto precisa e realistica, grazie a dati in tempo reale su traffico, incidenti, deviazioni di percorso e grazie allo storico delle tratte percorse dalle loro migliaia di utenti.

Presa nota di questa dinamicità dei dati offerti dai provider e presi in considerazione tutti i mezzi possibili per affrontare un tragitto, la domanda alla base di questo studio è stata quella di chiedersi come queste stime di percorrenza varino lungo l'arco della giornata e delle settimane, per capire se esiste un mezzo universalmente migliore per ogni possibile tragitto e per studiarne eventuali variazioni.

Sebbene sia ragionevole dare per certo che l'auto di proprietà sia più veloce dei mezzi pubblici e delle biciclette, questo ragionamento potrebbe non reggere all'interno di una città come Milano. Infatti, come riportato dagli studi annuali svolti da TomTomIndex, in particolare l'ultimo del 2019\cite{tomtomindexmilan}, Milano rientra tra le prime 100 città su scala globale per livello di congestione stradale, con un traffico tale da far quasi raddoppiare i tempi di percorrenza in auto durante le ore di punta del mattino e del tardo pomeriggio. In aggiunta al fatto che alcuni mezzi non soffrono minimamente di questo problema, come le metropolitane, o ne soffrono parzialmente, come le biciclette, questo ha reso l'ipotesi di partenza sempre più discutibile.

Intorno alla grande aleatorietà a cui sono soggetti gli spostamenti è stato modellato questo studio, che ha l'obbiettivo di catturare di ora in ora le variazioni dovute a questi fenomeni urbani, mettendo a confronto i tempi di percorrenza stimati dai provider per ogni mezzo di trasporto su un percorso comune, ripetendo tale processo più volte e per diversi percorsi.

Qui di seguito sono riportati tutti gli step che hanno portato allo sviluppo dello studio, dalla progettazione a livello teorico di ogni elemento all'avvio del software per la raccolta dati.

\section{Percorsi da confrontare}

La scelta dei percorsi sulla quale basare i confronti è stata fatta analizzando due approcci possibili: generazione a random; tragitti prefissati. Fin da subito, l'approccio della scelta a priori delle tratte è risultata problematica per diversi motivi.

In primo luogo, la scelta stessa avrebbe introdotto bias cognitivi riguardo il possibile utente del percorso, per esempio selezionando tratte che portano a delle università, il che avrebbe portato ad analizzare la mobilità solamente dal punto di vista di uno studente o dipendente presso quelle determinate strutture.

Seconda problematica molto più rilevante sarebbe stata quella di selezionare involontariamente dei percorsi che favorissero un mezzo piuttosto che un altro. Nella città di Milano infatti si contanto numerosi tratti stradali di questo genere: strade con corsia preferenziale per mezzi pubblici e taxi; vie per cui non passano mezzi pubblici; strade a singola corsia e con numerosi semafori (quindi più soggetta a incolonnamenti); tangenziali; tratti coperti da passanti ferroviari. Tale scelta mi avrebbe portato ad analizzare dati non rappresentativi di tutta città, con conseguenti risultati in un certo senso "falsati".


L'idea alla base della simulazione è quella di simulare un utente "U" che si trova in un dato punto "A" di coordinate (w, x) che vuole dirigersi in un punto B di coordinate (y, z) chiedendo a un ipotetico servizio di navigazione di fornire, sulla base di dati in tempo reale (come traffico, orari dei mezzi pubblici, incidenti e strade chiuse), le migliori soluzioni di percorrenza di tale tratta per ogni mezzo di trasporto preso in considerazione, salvandone i risultati. Il tutto eseguito più volte durante l'arco della giornata, con diversi punti di partenza e di arrivo e di diversa lunghezza.

\todo{atrent: qui ci sarà da disquisire sulla scelta delle tratte: random arbitrarie o reali}

\section{Simulazione (implementazione)}

\subsection{Generazione delle tratte}

Ogni singola simulazione di percorrenza è stata effettuata con una tratta generata su richiesta con una funzione random. La funzione progettata per la generazione delle tratte crea due coordinate A e B a random e utilizza alcuni constraint per decidere se restituire la tratta o ripetere il processo di generazione. I constraint utilizzati per questo studio sono i seguenti: le tratte generate devono essere lunghe almeno 2km in via aerea; i punti di partenza e di arrivo delle tratte devono essere all'interno del Comune di Milano.

Il primo constraint è stato scelto appositamente per simulare delle tratte scomode da fare a piedi, ovvero tratte che supererebbero i 20/30 minuti di camminata per essere coperte e, allo stesso modo, per avere tratte che giustificherebbero l'uso della macchina, evitando quindi tratte 5 minuti di macchina.

Il secondo constraint è dovuto ai termini di servizio del car sharing, che obbliga l'utente a utilizzare i mezzi a disposizione del servizio solamente all'interno del Comune di Milano, escludendo le varie zone dell'hinterland che fanno provincia. Per fare un confronto alla pari sulle stesse tratte ho dovuto quindi escludere la periferia della città.

La generazione random delle tratte è stata scelta per non incentrare indirettamente lo studio su particolari categorie di utente, come strade piene di uffici per i lavoratori, strade con scuole e università per gli studenti o strade particolarmente trafficate per via della topografia della città. Il tentativo è stato quello di rendere la simulazione più neutra possibile, considerando una qualsiasi tipologia di utente.

\todo{atrent: in particolare qui, io metterei un collegamento col lavoro di Federico e fare anche qualche simulazione usando "tratte medie" estratte dai suoi campionamenti}

\subsection{Acquisizione dei dati}

I dati alla base di questo studio sono stati forniti tramite A.P.I dai seguenti servizi: HereWeGo (here.com) per le soluzioni di percorrenza coi mezzi pubblici ATM; Waze (waze.com) per la percorrenza in macchina; OpenStreetMap (openstreetmap.org) per la percorrenza in bici e a piedi; ... per il car sharing.

\subsubsection{Soluzioni di percorrenza}

HereWeGo e Waze forniscono soluzioni di percorrenza in tempo reale, tenendo conto delle condizioni attuali del traffico e della posizione dei mezzi. In particolare, Waze prende in considerazione il traffico, gli incidenti, le strade chiuse per lavori e le deviazioni, mentre HereWeGo prende in considerazione la posizione dei mezzi pubblici in tempo reale, indicando tempi di attesa, rallentamenti e deviazioni di percorso. OpenStreetMap invece fornisce soluzioni di percorrenza statiche, sia pedovia che in bicicletta, che non dipendono quindi dal traffico o da altre condizioni stradali. I dati di quest'ultimo infatti sono stati usati solamente come termini di riferimento. Le A.P.I di tali servizi sono nella forma:
\begin{lstlisting}[language=Go]
Service.GetRoute(A, B coordinate) Solution
\end{lstlisting}
dove il risultato restituito, in formato JSON, contiene la miglior soluzione di percorrenza per il servizio richiesto. Tra i dati contenuti nel risultato sono presenti informazioni come durata stimata del tragitto, step di navigazione, avvisi e alternative.

\subsubsection{Car sharing}

Dato che non sono stati trovati servizi per stimare la percorrenza di una tratta col car sharing, che includesse la ricerca di una macchina vicina al punto di partenza e infine una stima del percorso, ne è stato programmato uno ad hoc. Il servizio ... offre tramite un A.P.I una lista aggiornata in tempo reale di tutte le macchine parcheggiate, libere di essere prenotate:
\begin{lstlisting}[language=Go]
Service.GetFreeCars() []CarInfo
\end{lstlisting}
dove per ogni entry nella lista sono presenti i dati della macchina e le coordinate geografiche della posizione.

Per creare un servizio in grado di fornire una soluzione di percorrenza in car sharing basata su dati in tempo reale sono stati uniti tre servizi, quello di OpenStreetMap per la percorrenza a piedi, quello di Waze per la percorrenza in macchina e quello di ... per avere la lista aggiornata delle macchine libere. Sono stati usati nel seguente modo:
\begin{lstlisting}[language=Go]
func GetCarSharingRoute(A, B) Solution {
	freeCars = CarSharingService.GetFreeCars()
	C = findClosestCar(freeCars, A)
	
	footRoute = OpenStreetMap.GetRoute(A, C)
	carRoute = Waze.GetRoute(C, B)
	
	return Solution{
		footRoute.EstimatedTravelTime +
			carRoute.EstimatedTravelTime,
		...
	}
}
\end{lstlisting}
Dato un utente "U" che vuole andare da un punto "A" a un punto "B" in car sharing, il servizio creato appositamente procede nel scaricare la lista aggiornata delle macchine libere, cerca tra queste la macchina più vicina al punto di partenza desiderato "A" e ne calcola il tragitto a piedi per raggiungerla (punto "C"), dopodichè calcola il resto del tragitto, dalla posizione della macchina "C" al punto di destinazione desiderato "B", in macchina. Con questo metodo si è ottenuta una stima in tempo reale della percorrenza in car sharing per ogni tratta, che ha permesso a posteriori di ricavare altre informazioni utili, come per esempio il tempo medio per raggiungere un auto.

Per questione di semplicità, la ricerca della macchina più vicina è stata implementata con una algoritmo greedy che cerca la macchina fisicamente più vicina al punto di partenza, ignorando totalmente il verso di marcia del tragitto, possibilmente aumentando il tempo di percorrenza in macchina.

\subsection{Attuazione delle richieste e salvataggio}

La simulazione è stata programmata nel seguente modo:
\begin{enumerate}
\item ogni 60 secondi viene generata una tratta a random col generatore precedentemente discusso
\item parallelamente viene richiesto a tutti i servizi di fornire la soluzione migliore per percorrere tale tratta
\item il risultato viene salvato sotto forma di file JSON e compresso. Il processo si ripete
\end{enumerate}
E' stato scelto un intervallo di 60 secondi per permettere a tutti i servizi di risolvere la richiesta tramite A.P.I e per non eccedere il limite massimo di richieste mensili offerte gratuitamente dal servizio di HereWeGo.



\section{Raccolta dati}

La simulazione è stata programmata per andare in esecuzione dalle ore 7:00 alle ore 23:59 di ogni giorno per avere un confronto più alla pari. Infatti, prima delle ore 7:00 i mezzi pubblici operano con orario ridotto e meno mezzi, vista la bassa richiesta in quella fascia oraria.

I dati riguardanti la simulazione sono stati raccolti a partire dall'1 marzo 2020 per un periodo di circa 4 mesi, fino al 10 luglio 2020. Vista l'emergenza per epidemia da coronavirus (giusto scritto così?), tutta l'Italia è entrata in uno stato di lockdown annunciato per decreto legge dal 12 marzo 2020, allentando gradualmente le restrizioni a partire dal 4 maggio 2020. I dati all'interno di questo intervallo sono quindi da considerarsi poco utili all'analisi.

\todo{atrent: mi dicevi che hai stoppato gli script, però io andrei avanti almeno fino a fine anno}